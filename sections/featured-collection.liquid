{{ 'featured-collection.css' | asset_url | stylesheet_tag }}
{{ 'featured-product-grid.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign section_heading = section.settings.heading
  assign marker_style = section.settings.marker_style
  assign section_description = section.settings.description
  assign display_type = section.settings.display_type
  assign columns_desktop = section.settings.columns_desktop
  assign featured_collection = section.settings.collection
  assign show_view_all = section.settings.show_view_all
  assign product_limit = section.settings.product_limit
  assign mobile_swipe = section.settings.mobile_swipe
  assign show_progress_bar = section.settings.show_progress_bar
  assign marker_color = section.settings.marker_color
  assign disable_top_spacing = section.settings.disable_top_spacing
  assign disable_bottom_spacing = section.settings.disable_bottom_spacing

  assign columns_class = 'small-6 medium-6 large-4'
  case columns_desktop
    when 2
      assign columns_class = 'small-6 medium-6'
    when 3
      assign columns_class = 'small-6 medium-4'
    when 4
      assign columns_class = 'small-6 medium-6 large-3'
    when 5
      assign columns_class = 'small-6 medium-3 large-1/5'
    when 6
      assign columns_class = 'small-6 medium-3 large-2'
  endcase

  if featured_collection.all_products_count > product_limit
    assign more_in_collection = true
  endif

  if show_view_all and more_in_collection
    assign section_heading_button = featured_collection
  endif

  if display_type == 'carousel'
    assign element = 'slide-show'
  else
    assign element = 'div'
  endif
-%}

<style>
      .featured-collection-{{ section.id }} {
        padding: 0;
        margin: 100px 0 100px auto;
        max-width: none;
        padding-left: 8.33vw;
        padding-right: 8.33vw;
      }

      .featured-collection-{{ section.id }} .section-header--title {
        font-size: 40px !important;
        line-height: 38px;
        font-weight: 800;
      }

      .featured-collection-{{ section.id }} > .row {
        padding: 0;
        max-width: none;
      }

      .featured-collection-{{ section.id }} > .row .columns {
        padding: 0;
        position: relative !important;
        transform: translateX(0%) !important;
      }

      {% comment %} .featured-collection-{{ section.id }} > .row .columns.carousel__slide {
        {% if section.settings.carousel_count == '24.4' %}
          flex: 0 0 19.61%;
          max-width: 19.61% ;
        {% elsif section.settings.carousel_count == '23.8' %}
          flex: 0 0 19.23%;
          max-width: 19.23% ;
        {% elsif section.settings.carousel_count == '23.2' %}
          flex: 0 0 18.87%;
          max-width: 18.87% ;
        {% endif %}
      } {% endcomment %}
      {% comment %} @media only screen and (max-width: 1930px){
        .featured-collection-{{ section.id }} > .row .columns.carousel__slide {
          flex: 0 0 {{section.settings.carousel_count}}%;
          max-width: {{section.settings.carousel_count}}% ;
          height: 100%;
        }
      } {% endcomment %}
      .featured-collection-{{ section.id }} .flickity-slider {
        display: flex;
        position: relative;
        height: auto;
    }

      .featured-collection-{{ section.id }} > .row .columns.carousel__slide {
        flex: 0 0 {{section.settings.carousel_count}}%;
        max-width: {{section.settings.carousel_count}}% ;
        width: {{section.settings.carousel_count}}%;
        height: auto;
      }

      .featured-collection-{{ section.id }} product-card .product-card-info custom-automatic-discount-reminder {
        width: auto !important;
        margin-top: 15px;
        margin-bottom: 0px;
        border-radius: 0;
        font-weight: 700;
        padding: 0;
        line-height: 1.5;
        font-size: 16px;
      }

      .featured-collection-{{ section.id }} .product-card-price-and-button {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .featured-collection-{{ section.id }} .price {
        display: inline-flex;
        flex-direction: row !important;
        line-height: 1;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: start;
      }

      .featured-collection-{{ section.id }} span.badge_ul:before {
        content: "";
        position: relative;
        background: none;
        top: 0;
        left: 0;
        z-index: -1;
        width: 0;
        height: 0;
        background-size: contain;
        display: none;
      }

      .featured-collection-{{ section.id }} .price > del {
        min-width: max-content;
        color: #C2C2C2;
      }

      .featured-collection-{{ section.id }} .product-card .badge.top {
        top: 0;
        color: #fff;
        padding: 6px 14px;
        display: inline-flex;
        height: auto;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        flex-shrink: 0;
        border-radius: 5px;
        background: linear-gradient(90deg, #FFBF00 -9.86%, #F10 51.87%, #FF00E0 115.74%);
        left: 0 !important;
        width: max-content;
      }

      .featured-collection-{{ section.id }} .section-header {
        padding: 0;
        margin-bottom: 60px;
        margin-left: 0;
        margin-right: 0;
        max-width: none;
        align-items: center;
      }

      .featured-collection-{{ section.id }} .flickity-progress {
        display: block;
        width: 600px;
        height: 3px;
        background: #D9D9D9;
        border-radius: 0;
        position: relative;
        margin-top: 50px;
        margin-left: auto;
        margin-right: auto;
        opacity: 0;
      }

      .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper .product-card--add-to-cart-button {
        border-radius: 5px !important;
        border: 1px solid #FF8F1C;

      }

      .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper:before {
        border-radius: 5px !important;
        background-color: #FF8F1C;
      }

      .featured-collection-{{ section.id }}:hover .flickity-progress {
        opacity: 1;
      }

      .featured-collection-{{ section.id }} .flickity-progress--bar {
        position: absolute;
        top: 0;
        left: 0;
        height: 3px;
        background: #000;
        width: 0%;
        border-radius: 0;
      }


      .featured-collection-{{ section.id }} .flickity-viewport {
        overflow: visible;
        position: relative;
        {% comment %} height: auto !important; {% endcomment %}
        min-width: 100%;
        {% comment %} min-height: 786px; {% endcomment %}
      }
      @media only screen and (max-width: 2561px){
        .featured-collection-{{ section.id }} .flickity-viewport {

          {% comment %} min-height: 734px; {% endcomment %}
        }
      }
      @media only screen and (max-width: 1921px){
        .featured-collection-{{ section.id }} .flickity-viewport {

          {% comment %} min-height: 624px; {% endcomment %}
        }
        .featured-collection-{{ section.id }} .flickity-nav {
          top: 60% !important;
        }
      }
      @media only screen and (max-width: 1601px){
        .featured-collection-{{ section.id }} .flickity-viewport {

          {% comment %} min-height: 561px; {% endcomment %}
        }
      }
      @media only screen and (max-width: 1441px){
        .featured-collection-{{ section.id }} .flickity-viewport {

          {% comment %} min-height: 625px; {% endcomment %}
        }
      }
      .featured-collection-{{ section.id }} .flickity-nav {
        top: 60% !important;
        width: 50px;
        height:50px;
        background: rgba(0, 0, 0, 0.3);
      }

   .featured-collection-{{ section.id }} .flickity-nav:hover {
      background: rgba(0, 0, 0, 0.1);
  }
      @media only screen and (min-width: 768px) {
        .featured-collection-{{ section.id }} .product-card .badge.top {
          top: 0;
        }

        .featured-collection-{{ section.id }} .product-card .badge.left {
          left: 0;
        }

      }

      @media print, screen and (max-width: 1600px) {
        .featured-collection-{{ section.id }} {
          padding: 0;
          margin: 100px 0 100px 0 !important;
          max-width: none;
          padding-left: 8.33vw;
          padding-right: 8.33vw;
        }

        .featured-collection-{{ section.id }} > .row .columns.carousel__slide {
          {% if section.settings.carousel_count == '24.4' %}
            flex: 0 0 32.6%;
            max-width: 32.6%;
            width: 32.6%;
          {% elsif section.settings.carousel_count == '23.8' %}
            flex: 0 0 31.8%;
            max-width: 31.8%;
            width: 31.8%;
          {% elsif section.settings.carousel_count == '23.2' %}
            flex: 0 0 30.3%;
            max-width: 30.3%;
            width: 30.3%;
          {% endif %}
        }
      }

      .featured-collection-{{ section.id }} .product-card--content-spacing-true .product-featured-image {
        padding: 0;
      }

      .featured-collection-{{ section.id }} product-card .product-card-info custom-automatic-discount-reminder {
        margin-bottom: 10px;
      }

      .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper,
      .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper .product-card--add-to-cart-button {
        border-radius: 5px;
      }

      .featured-collection-{{ section.id }} .section-header--button .text-button:hover {
        opacity: 1 !important;
        color: #DA291C !important;
      }

      @media screen and (max-width: 768px) {
        .featured-collection-{{ section.id }} {
          padding: 0;
          margin: 50px 0 50px 0 !important;
          max-width: none;
          padding-left: auto;
        }
        .featured-collection-{{ section.id }} .product-card-info .price {

          flex-direction: column !important;

        }
        .featured-collection-{{ section.id }} .section-header {

          align-items: start;
        }
        .featured-collection-{{ section.id }} .product-card-price-and-button {
          align-items: center;
          justify-content: space-between;
        }

        .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper {
          width: 34px;
          height: 26px;
          background: transparent;
          padding: 0;
          position: relative;
          min-width: 74px;
          width: auto;
          border-radius: 0;
          overflow: hidden;
          vertical-align: bottom;
          display: inline-block;
          margin: 0;
        }

        .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper .product-card--add-to-cart-button {
          height: 100%;
          box-sizing: border-box;
          border: 1px solid #FF8F1C;
          background-color: transparent;
          position: relative;
          border-radius: 5px;
          line-height: 1;
        }

        .featured-collection-{{ section.id }} .product-card--add-to-cart-button-wrapper .product-card--add-to-cart-button:hover .product-card--add-to-cart-text:after {
          color: #000 !important;
        }

        .featured-collection-{{ section.id }} .product-card-info .product-card--add-to-cart-text:after {
          content: "Buy Now";
          font-size: 12px !important;
          font-weight: 700;
          text-align: center;
          width: 100%;
          display: block;
          color: #000;
          transition: color .1s ease;
          margin-bottom: 0;
        }

        .featured-collection-{{ section.id }} .featured-collection {
          margin-left: 0 !important;
        }

        .featured-collection-{{ section.id }} .section-header--title {
          max-width: 100% !important;
          font-size: 24px !important;
        }
      }

      @media screen and (max-width: 749px) {
        .featured-collection-{{ section.id }} > .row {
          padding: 0 24px;
          max-width: none;
          padding-right: 0;
        }

        .featured-collection-{{ section.id }} .flickity-viewport {
          overflow: hidden;
          position: relative;
          height: auto !important;
          min-width: 100%;
          {% comment %} min-height: 550px; {% endcomment %}
        }

        .featured-collection-{{ section.id }} .flickity-progress {
          display: block;
          width: auto;
          height: 2px;
          background: #D9D9D9;
          border-radius: 0;
          position: relative;
          margin-top: 30px;
          margin-left: auto;
          margin-right: 24px;
          opacity: 1;
        }

        .featured-collection-{{ section.id }} .product-card .badge.top {
          top: 0;
          color: #fff;
          padding: 5px 12px;
          display: inline-flex;
          height: auto;
          align-items: center;
          gap: 5px;
          font-size: 12px;
          flex-shrink: 0;
          border-radius: 5px;
          background: linear-gradient(90deg, #FFBF00 -9.86%, #F10 51.87%, #FF00E0 115.74%);
          left: 0 !important;
          width: max-content;
        }

        .featured-collection-{{ section.id }} > .row .columns.carousel__slide {
          flex: 0 0 {{section.settings.carousel_count_mobile}}%;
          max-width: {{section.settings.carousel_count_mobile}}%;
          width: {{section.settings.carousel_count_mobile}}%;
          {% comment %} height: 100%; {% endcomment %}
        }

        .featured-collection-{{ section.id }} product-card .product-card-info custom-automatic-discount-reminder {
          margin: 10px -20px;
        }

        .featured-collection-{{ section.id }} .section-header--button {
          font-size: 14px !important;
          color: #DA291C !important;
          margin-bottom: 20px !important;
        }

        .featured-collection-{{ section.id }} .product-card--content-spacing-true .product-featured-image {
          padding: 0;
        }
      }
</style>
<div class="featured-collection-{{ section.id }} featured-collection{% if mobile_swipe %} swipe-on-mobile{% endif %} section-spacing{% if disable_top_spacing %} section-spacing--disable-top{% endif %}{% if disable_bottom_spacing %} section-spacing--disable-bottom{% endif %}">
  <div class="row">
    <div class="small-12 columns">
      {% render 'section-header',
        section_heading: section_heading,
        section_description: section_description,
        section_heading_button: section_heading_button,
        text_button_title: 'View All >>',
        marker_color: marker_color,
        marker_style: marker_style
      %}
      <div class="featured-collection__inner display-type--{{ display_type }}">
        <{{ element }} id="product-grid-{{ section.id }}" class="products row {{ display_type | append: '2' }}">
          {%- if featured_collection != blank -%}
            {%- for product in featured_collection.products limit: product_limit -%}
              <div class=" {{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}">
                {% render 'featured-product-card', product_card_product: product, enable_klarna: false %}
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- for i in (1..product_limit) -%}
              <div class="{{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}">
                {% render 'featured-product-card' %}
              </div>
            {%- endfor -%}
          {%- endif -%}
          {%- if display_type == 'carousel' -%}
            {%- if product_limit > columns_desktop -%}
              <div class="carousel__slide_controls">
                <div class="flickity-nav flickity-prev" tabindex="0">
                  <svg width="11" height="16" viewBox="0 0 11 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.26074 1.47827C8.88031 1.8261 4.02976 5.68117 1.65205 7.56523L9.26074 14.5217" stroke="#999999" stroke-opacity="1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </div>
                <div class="flickity-nav flickity-next" tabindex="0">
                  <svg width="11" height="16" viewBox="0 0 11 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1.73926 1.47827C2.11969 1.8261 6.97024 5.68117 9.34795 7.56523L1.73926 14.5217" stroke="#DA281C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </div>
              </div>
            {%- endif -%}
          {%- endif -%}
        </{{ element }}>
        {%- if display_type == 'carousel' and show_progress_bar -%}
          <div class="flickity-progress">
            <div class="flickity-progress--bar"></div>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    var artHeight = $('.flickity-viewport').outerHeight();
    console.log('artHeight===========', artHeight);
    $('.flickity-viewport').css({
      height: 'auto',
    });
  });
</script>

{% schema %}
{
  "name": "Featured collection",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collection",
      "info": "Wrap your text between | to add animated markers. For example: Animated |marker| will underline marker text."
    },
    {
      "type": "select",
      "id": "marker_style",
      "options": [
        {
          "value": "style1",
          "label": "Basic"
        },
        {
          "value": "style2",
          "label": "Double"
        },
        {
          "value": "style3",
          "label": "Squiggle"
        },
        {
          "value": "style4",
          "label": "Zigzag"
        }
      ],
      "default": "style1",
      "label": "Marker"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Describe your featured collection here</p>"
    },
    {
      "type": "header",
      "content": "Collection"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "select",
      "id": "display_type",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        }
      ],
      "default": "grid",
      "label": "Display type"
    },
    {
      "type": "range",
      "id": "product_limit",
      "min": 2,
      "max": 12,
      "step": 1,
      "label": "Maximum products to show",
      "default": 4
    },
    {
      "type": "select",
      "id": "carousel_count",
      "label": "轮播显示数目",
      "options": [
        {
          "value": "25",
          "label": "4"
        },

        {
          "value": "24.4",
          "label": "4.1"
        },

        {
          "value": "23.8",
          "label": "4.2"
        },
        {
          "value": "23.2",
          "label": "4.3"
        },

        {
          "value": "33",
          "label": "3"
        },
        {
          "value": "32.6",
          "label": "3.1"
        },
        {
          "value": "32.2",
          "label": "3.2"
        },
        {
          "value": "31.8",
          "label": "3.3"
        },
        {
          "value": "50",
          "label": "2"
        }
      ],
      "default": "25",
      "info": "仅开启轮播时有效"
    },
    {
      "type": "select",
      "id": "carousel_count_mobile",
      "label": "轮播显示数目(手机端)",
      "options": [
        {
          "value": "91",
          "label": "1.1"
        },
        {
          "value": "83.33",
          "label": "1.2"
        },
        {
          "value": "76.92",
          "label": "1.3"
        },
        {
          "value": "50",
          "label": "2"
        },
        {
          "value": "47.6",
          "label": "2.1"
        },
        {
          "value": "45.45",
          "label": "2.2"
        },
        {
          "value": "43.2",
          "label": "2.3"
        }
      ],
      "default": "83.33",
      "info": "仅开启轮播时有效"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "default": true,
      "label": "Enable \"View all\" button if collection has more products than shown"
    },
    {
      "type": "header",
      "content": "Grid"
    },
    {
      "type": "checkbox",
      "id": "mobile_swipe",
      "default": true,
      "label": "Enable swipe on mobile"
    },
    {
      "type": "header",
      "content": "Carousel"
    },
    {
      "type": "checkbox",
      "id": "show_progress_bar",
      "label": "Show progress bar",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "marker_color",
      "label": "Marker",
      "default": "#FD6262"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "checkbox",
      "id": "disable_top_spacing",
      "default": false,
      "label": "Remove top spacing"
    },
    {
      "type": "checkbox",
      "id": "disable_bottom_spacing",
      "default": false,
      "label": "Remove bottom spacing"
    }
  ],
  "presets": [
    {
      "name": "Featured collection"
    }
  ]
}
{% endschema %}
