{{- 'slideshow.css' | asset_url | stylesheet_tag -}}

{%- liquid
  assign desktop_height = section.settings.desktop_height
  assign mobile_height = section.settings.mobile_height
  assign full_width = section.settings.full_width
  assign transition = section.settings.transition
  assign autoplay = section.settings.autoplay
  assign disable_top_spacing = section.settings.disable_top_spacing
  assign disable_bottom_spacing = section.settings.disable_bottom_spacing

  case mobile_height
    when 'mobile-height-400'
      assign mobile_image_height = 400
    when 'mobile-height-450'
      assign mobile_image_height = 450
    when 'mobile-height-500'
      assign mobile_image_height = 500
    else
      assign mobile_image_height = 500
  endcase

  assign fade = true
  if transition == 'slide'
    assign fade = false
  endif

  assign dots = true

  assign preload = true

  if section.index == 1
    assign preload = true
  endif
-%}
<div class="slideshow-v2-container-{{ section.id }} row{% if full_width %} full-width-row{% endif %} swiper-now">
  <div class="caption">
    <h3 class="{{ section.settings.heading_size }}">{{ section.settings.heading | newline_to_br }}</h3>
    <div class="rte description-size--{{ section.settings.description_size }}" {{ section.shopify_attributes }}>
      {{ section.settings['short-description'] }}
    </div>
  </div>
  <style>
    .slideshow-v2-container-{{ section.id }} {
    }
    .slideshow-v2-container-{{ section.id }}   .slideshow__slide-bg {
         background: unset;
       }
       .slideshow-v2-container-{{ section.id }}  .swiper-container-block {
         position: relative;
       }

      .mySwiper-{{ section.id }} {
         height: 100%;
         width: 100%;
         margin-bottom: 0;
       }
       .mySwiper2-{{ section.id }} {

         box-sizing: border-box;
         padding: 0;
         width: max-content;
         margin-top: 0
       }
       .slideshow-v2-container-{{ section.id }} .caption h3 {
        font-weight: 800;
        font-size: 56px;
        line-height: 1.14;
      }
      .slideshow-v2-container-{{ section.id }}  .caption {
        max-width: 980px;
        text-align: center;
        margin-bottom: 60px;
        margin-left: auto;
        margin-right: auto;
        font-weight: 400;
        font-size: 18px;
        color: #000000;
        font-family: "Mulish", serif !important;
      }
      .slideshow-v2-container-{{ section.id }}  .description-size--small {
        line-height: 1.25;
      }
      .slideshow-v2-container-{{ section.id }}{
        max-width: none;
        margin-right: 0;
        margin-left: 0;
        padding: 0 24px;
      }
       .mySwiper2-{{ section.id }} .swiper-slide {
         width: max-content !important;
         height: 100%;
         font-weight: 800;
         font-size: 16px;
         line-height: 1.375;
         color: #b4b4b4;
         border-bottom: solid 1px #d9d9d9;
         display: flex;
         justify-content: center;
         align-content: center;
         align-items: center;
         cursor: pointer;
         padding-bottom: 10px;
       }
       .mySwiper2-{{ section.id }} .swiper-slide-thumb-active {
         color: #000000;
         font-weight: bold;
         border-bottom: solid 1px #000;
       }
       .mySwiper-{{ section.id }} .swiper-slide {
         text-align: center;
         font-size: 18px;
         display: flex;
         justify-content: center;
         align-items: center;
         background: unset;
         opacity: 0.2;
       }
       .mySwiper-{{ section.id }} .swiper-slide-active {
         opacity: 1;
       }

       .mySwiper-{{ section.id }}    .swiper-slide img {

         width: 100%;
         max-width: 100%;
         height: auto;
         object-fit: cover;
       }

       .slideshow-v2-container-{{ section.id }}  .swiper-horizontal > .swiper-pagination-bullets,
       .slideshow-v2-container-{{ section.id }}  .swiper-pagination-bullets.swiper-pagination-horizontal,
       .slideshow-v2-container-{{ section.id }}  .swiper-pagination-custom,
       .slideshow-v2-container-{{ section.id }}  .swiper-pagination-fraction {
         cursor: pointer;
         width: 119px;
         height: 200px;
         border-radius: unset;
         margin: 0;
       }
       .mySwiper-{{ section.id }} .slideshow-image--desktop{
        display: block;
       }
       .mySwiper-{{ section.id }} .swiper-horizontal > .swiper-pagination-bullets {
         display: none;
       }
       .mySwiper-{{ section.id }} .slideshow-image--mobile{
        display: none;
      }
      .mySwiper-{{ section.id }} .slideshow__slide-bg {
        position: relative;

    }
       @media only screen and (max-width: 768px) {
         .mySwiper2-{{ section.id }} {
           padding: 0 0 20px 0;
           width: 327px;
         }

         .mySwiper2-{{ section.id }} .swiper-slide {
           font-size: 14px;
           line-height: 14px;
         }
         .mySwiper-{{ section.id }} .slideshow-image--mobile{
          display: block;
        }
        .mySwiper-{{ section.id }} .slideshow-image--desktop{
          display: none;
         }
       }
  </style>
  <div class=" small-12 columns swiper-container-block section-spacing{% if disable_top_spacing %} section-spacing--disable-top{% endif %}{% if disable_bottom_spacing %} section-spacing--disable-bottom{% endif %}">
    <div class="swiper-container mySwiper-{{ section.id }} slideshow--full-width-{{ full_width }} carousel {{ mobile_height }}  transition--{{ transition }}">
      <div class="swiper-wrapper">
        {%- for block in section.blocks -%}
          {%- liquid
            assign content_position = block.settings.content_position
            assign text_alignment = block.settings.text_alignment
            assign content_size = block.settings.content_size
            assign color_text = block.settings.color_text

            assign color_slidebg = block.settings.color_slidebg
            assign color_slidebg_opacity = block.settings.color_slidebg_opacity
            assign color_slidebg_blur = block.settings.color_slidebg_blur

            assign overlay_color = block.settings.overlay_color
            assign overlay_opacity = block.settings.overlay_opacity

            assign has_visible_bg = false
            if color_slidebg_blur > 0 or color_slidebg != 'rgba(0,0,0,0)'
              assign has_visible_bg = true
            endif

            if color_slidebg == 'rgba(0,0,0,0)'
              assign color_slidebg_opacity = 0
            endif

            assign priority = false

            if forloop.index == 1 and preload
              assign priority = 'high'
            endif
          -%}
          <div
            class="swiper-slide text-{{ text_alignment }}"
            style="--color-text: {{ color_text }}; --overlay-color-rgb: {{ overlay_color.rgb | replace: ' ' , ',' }}; --overlay-opacity: {{ overlay_opacity | divided_by: 100.0 }}; --color-slidebg-rgb: {{ color_slidebg.rgb | replace: ' ' , ',' }}; --color-slidebg-opacity: {{ color_slidebg_opacity | divided_by: 100.0 }}; --bg-blur: {{ color_slidebg_blur | append: 'px' }} "
          >
            <div class="slideshow__slide-bg">
              {%- if block.settings.image -%}
                {%- liquid
                  assign image = block.settings.image
                  assign master_width = image.src.width | append: 'x' | append: image.src.height
                  assign width = '375x' | append: mobile_image_height | append: ',' | append: master_width
                  assign class = null

                  if block.settings.mobile_image != blank
                    assign class = 'slideshow-image--desktop'
                  endif
                -%}
                {%- render 'responsive-image', image: image, sizes: width, class: class, priority: priority -%}
              {%- else -%}
                {%- assign index = forloop.index | modulo: 2 | plus: 1 -%}
                {{ 'lifestyle-' | append: index | placeholder_svg_tag: 'placeholder_svg_tag' }}
              {%- endif -%}
              {%- if block.settings.mobile_image != blank -%}
                {%- liquid
                  assign image = block.settings.mobile_image
                  assign master_width = image.src.width | append: 'x' | append: image.src.height
                  assign width = '375x' | append: mobile_image_height | append: ',' | append: master_width
                -%}
                {%- render 'responsive-image',
                  image: image,
                  sizes: width,
                  class: 'slideshow-image--mobile',
                  priority: priority
                -%}
              {%- endif -%}
            </div>

            {% if block.settings.slide_link != blank %}
              <a
                href="{{ block.settings.slide_link }}"
                class="slideshow__slide-content-link"
                target="_blank"
                tabindex="-1"
              >
                <div class="slideshow__slide-overlay" style="background: {{ block.settings.overlay_gradient }}"></div>
              </a>
            {% endif %}
          </div>
        {%- endfor -%}
      </div>
    </div>

    <div class="swiper-container mySwiper2-{{ section.id }}">
      <div class="swiper-wrapper">
        {%- for block in section.blocks -%}
          <div class="swiper-slide">
            {{ block.settings.heading | newline_to_br }}
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const galleryThumbsV2 = new Swiper('.mySwiper2-{{ section.id }}', {
      spaceBetween: 10,
      slidesPerView: 3,
      freeMode: true,
      watchSlidesVisibility: true,
      watchSlidesProgress: true,
      breakpoints: {
        768: {
          slidesPerView: 3,
        },
      },
    });

    const galleryTop = new Swiper('.mySwiper-{{ section.id }}', {
      spaceBetween: 34,
      centeredSlides: true,
      slidesPerView: 2.5,
      thumbs: {
        swiper: galleryThumbsV2,
      },
      breakpoints: {
        798: {
          slidesPerView: 1,
        },
      },
    });
  });
</script>

{% schema %}
{
  "name": "Swiper V1",
  "class": "section-swiper",
  "settings": [
    {
      "type": "textarea",
      "id": "heading",
      "label": "Heading",
      "default": "Slidershow Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "h1",
          "label": "Large"
        },
        {
          "value": "h2",
          "label": "Medium"
        },
        {
          "value": "h3",
          "label": "Small"
        }
      ],
      "default": "h1"
    },
    {
      "type": "select",
      "id": "description_size",
      "label": "Description size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium"
    },
    {
      "type": "textarea",
      "id": "short-description",
      "label": "Short Description",
      "default": "Short Description"
    },
    {
      "type": "select",
      "id": "desktop_height",
      "label": "Desktop height",
      "options": [
        {
          "value": "desktop-height-image",
          "label": "Adapt to image"
        },
        {
          "value": "desktop-height-auto",
          "label": "Adapt to content"
        },
        {
          "value": "desktop-height-400",
          "label": "400px"
        },
        {
          "value": "desktop-height-450",
          "label": "450px"
        },
        {
          "value": "desktop-height-500",
          "label": "500px"
        },
        {
          "value": "desktop-height-550",
          "label": "550px"
        },
        {
          "value": "desktop-height-600",
          "label": "600px"
        },
        {
          "value": "desktop-height-650",
          "label": "650px"
        },
        {
          "value": "desktop-height-750",
          "label": "750px"
        },
        {
          "value": "desktop-height-full",
          "label": "Full screen"
        }
      ],
      "default": "desktop-height-650"
    },
    {
      "type": "select",
      "id": "mobile_height",
      "label": "Mobile height",
      "options": [
        {
          "value": "mobile-height-image",
          "label": "Adapt to image"
        },
        {
          "value": "mobile-height-auto",
          "label": "Adapt to content"
        },
        {
          "value": "mobile-height-400",
          "label": "400px"
        },
        {
          "value": "mobile-height-450",
          "label": "450px"
        },
        {
          "value": "mobile-height-500",
          "label": "500px"
        },
        {
          "value": "mobile-height-550",
          "label": "550px"
        },
        {
          "value": "mobile-height-600",
          "label": "600px"
        },
        {
          "value": "mobile-height-full",
          "label": "Full screen"
        }
      ],
      "default": "mobile-height-500"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Make section full width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_length",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "select",
      "id": "transition",
      "label": "Transition",
      "options": [
        {
          "value": "zoom",
          "label": "Zoom"
        },
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        }
      ],
      "default": "zoom"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "checkbox",
      "id": "disable_top_spacing",
      "default": false,
      "label": "Remove top spacing"
    },
    {
      "type": "checkbox",
      "id": "disable_bottom_spacing",
      "default": false,
      "label": "Remove bottom spacing"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "2800 x 1000 .jpg recommended for full screen layouts."
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image (optional)"
        },
        {
          "id": "slide_link",
          "type": "url",
          "label": "Slide link",
          "info": "Adds a link to slide image"
        },
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "textarea",
          "id": "heading",
          "label": "Heading",
          "default": "Slide Heading"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Swiper V1",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
