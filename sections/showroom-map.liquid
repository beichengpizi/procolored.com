<style>
  #shopify-section-{{ section.id }} .layout {
    display: flex;
    gap: 20px;
    padding-bottom: 48px;
    flex-direction: column;
    align-content: center;
    flex-wrap: wrap;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .map-wrapper {
    max-width: 1400px;
    display: flex;
    width: 100%;
    gap: 32px;
    padding: 32px;
    border-radius: 16px;
    background: #fff;
  }

  #shopify-section-{{ section.id }} .map-box {
    flex: 1.2;
    border-radius: 12px;
    overflow: hidden;
    max-width: 538px;
    max-height: 538px;
  }

  #shopify-section-{{ section.id }} #map {
    width: 100%;
    height: 600px;
  }

  #shopify-section-{{ section.id }} .list-box {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  #shopify-section-{{ section.id }} .list-title {
    color: #0F0C00;
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 15px;
  }

  #shopify-section-{{ section.id }} #showroomList {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  #shopify-section-{{ section.id }} .showroom-wrapper {
    background: white;
    border: 2px solid transparent;
    cursor: pointer;
    transition: 0.2s;
  }

  #shopify-section-{{ section.id }} .showroom-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    background: #fff;
    border-radius: 10px;
    padding: 14px 24px;
    border: 1px solid #E0E0E0;
  }

  #shopify-section-{{ section.id }} .showroom-item:hover {
    border: 1px solid #5a8cff;
  }

  #shopify-section-{{ section.id }} .showroom-item.active {
    border: 1px solid #2b6cff;
  }

  #shopify-section-{{ section.id }} .showroom-item .name {
    color: #0F0C00;
    font-size: 24px;
    margin-bottom: 6px;
    font-weight: 700;
  }

  #shopify-section-{{ section.id }} .status {
    display: inline-block;
    font-size: 18px;
    padding: 0px 8px;
    border-radius: 9999px;
    margin-bottom: 6px;
  }

  #shopify-section-{{ section.id }} .status.open {
    color: #2ecc71;
    background: #eafaf1;
    width: fit-content;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  #shopify-section-{{ section.id }} .status.resting {
    color: #888;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    width: fit-content;
    gap: 4px;
  }
  #shopify-section-{{ section.id }} .status.constructing {
    color: #f39c12;
    background: #fef5e6;
  }

  #shopify-section-{{ section.id }} .time,
  #shopify-section-{{ section.id }} .addr {
    font-size: 18px;
    color: #5D5D5D;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  #shopify-section-{{ section.id }} .stars-wrapper {
    display: flex;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .result-num {
    font-size: 18px;
    font-weight: 600;
    color: #165DFF;
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
  }

  #shopify-section-{{ section.id }} .title-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  #shopify-section-{{ section.id }} .section-header--title {
    font-weight: 700;
    text-align: center;
  }

  #shopify-section-{{ section.id }} .section-header--description {
    color: #5D5D5D;
    text-align: center;
    font-size: 24px;
  }

  #shopify-section-{{ section.id }} .stars-rating {
    padding-left: 8px;
    font-size: 16px;
  }

  #shopify-section-{{ section.id }} .total-rating {
    color: #9CA3AF;
    font-size: 14px;
  }

  #shopify-section-{{ section.id }} .mobile {
    display: none;
  }

  @media screen and (max-width: 1400px) {
    #shopify-section-{{ section.id }} .layout {
        padding: 0 36px;
    }
  }

  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} .layout {
        padding: 0 16px;
    }

    #shopify-section-{{ section.id }} .mobile {
      display: block;
    }

    #shopify-section-{{ section.id }} .desktop {
      display: none;
    }

    #shopify-section-{{ section.id }} .layout {
      display: flex;
      gap: 20px;
      padding-bottom: 48px;
      flex-direction: column;
      align-content: center;
      flex-wrap: wrap;
      align-items: center;
    }

    #shopify-section-{{ section.id }} .map-wrapper {
      padding: 0;
      background: transparent;
    }

    #shopify-section-{{ section.id }} .map-box {
      display: none;
    }

    #shopify-section-{{ section.id }} #map {
      width: 100%;
      height: 600px;
    }

    #shopify-section-{{ section.id }} .list-box {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #shopify-section-{{ section.id }} .list-title {
      font-size: 20px;
    }

    #shopify-section-{{ section.id }} #showroomList {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #shopify-section-{{ section.id }} .showroom-wrapper {
      background: white;
      border: 2px solid transparent;
      cursor: pointer;
      transition: 0.2s;
    }

    #shopify-section-{{ section.id }} .showroom-header {
      gap: 8px;
      display: flex;
    }

    #shopify-section-{{ section.id }} .showroom-item {
      border-radius: 12px;
      padding: 24px;
      gap: 24px;
    }

    #shopify-section-{{ section.id }} .name-status {
      display: flex;
      flex-direction: column;
    }

    #shopify-section-{{ section.id }} .showroom-item:hover {
      border: 1px solid #5a8cff;
    }

    #shopify-section-{{ section.id }} .showroom-item.active {
      border: 1px solid #2b6cff;
    }

    #shopify-section-{{ section.id }} .showroom-item .name {
      font-size: 16px;
    }

    #shopify-section-{{ section.id }} .status {
      font-size: 12px;
    }

    #shopify-section-{{ section.id }} .time,
    #shopify-section-{{ section.id }} .addr {
      font-size: 12px;
    }

    #shopify-section-{{ section.id }} .time svg,
    #shopify-section-{{ section.id }} .addr svg  {
      width: 12px;
      height: 12px;
    }

    #shopify-section-{{ section.id }} .result-num {
      font-size: 14px;
    }

    #shopify-section-{{ section.id }} .section-header--title {
      font-size: 20px;
    }

    #shopify-section-{{ section.id }} .section-header--description {
      font-size: 16px;
    }

    #shopify-section-{{ section.id }} .stars-wrapper svg {
      width: 12px;
      height: 12px;
    }

    #shopify-section-{{ section.id }} .stars-rating {
      font-size: 12px;
    }

    #shopify-section-{{ section.id }} .total-rating {
      font-size: 12px;
    }
  }
</style>

<div class="layout" id="showroom-map">
    {% render 'section-header', section_heading: section.settings.section_heading, section_description: section.settings.description %}
    <div class="map-wrapper">
        <!-- Left Map -->
        <div class="map-box">
            <div id="map"></div>
        </div>

        <!-- Right Showroom List -->
        <div class="list-box">
            <div class="title-wrapper">
                <div class="list-title">Showroom List</div>
                <div class="result-num"></div>
            </div>

            <div id="showroomList"></div>
        </div>
    </div>
</div>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgDxBObkrSzvxaBo_yb5u94CFZE3kBFWQ"></script>

<script>
  const api = 'https://booster.procolored.com';
   {% comment %} const api = 'https://test.procolored.com'; //测试环境 {% endcomment %}
  const showRoomMapApi = "/procolored/activity/showroom/getShowroomList";
  const showRoomTimeSlotApi = "/procolored/activity/showroom/getTimeSlot";
  const availableTimeSlotsApi = "/procolored/activity/showroom/availableTimeSlots";

  let map;
  let marker;

  let showroomId = 1;

  const timeSlots = document.getElementById("timeSlots");

  async function loadShowrooms() {
    try {
      await fetch(`${api}${showRoomMapApi}?pageNum=1&pageSize=10`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
      }).then(response => {
        if(!response.ok) {
            throw new Error('网络请求失败');
        }
        return response.json();
      }).then(data => {
        if(data.code === 200) {
          const result = data.result;
          // 渲染右侧列表
          renderShowroomList(result);
          document.querySelector(".result-num").innerHTML = `${data.resultSize} Results`;
          // 初始化地图（使用第一个 showroom）
          initMap(result[0]);
        }
      });
    } catch (err) {
      console.error("请求失败", err);
    }
  }

  /** 渲染 Showroom 列表 */
  function renderShowroomList(list) {
    const container = document.getElementById("showroomList");
    container.innerHTML = "";

    list.forEach((item, index) => {
      const el = document.createElement("div");
      el.className = `showroom-item ${index === 0 ? "active" : ""}`;
      el.dataset.lat = item.lat;
      el.dataset.lng = item.lng;
      el.dataset.id = item.id;

      el.innerHTML = `
        <svg class="desktop" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="48" height="48" rx="8" fill="#165DFF" fill-opacity="0.1"/>
            <path d="M32.0196 23C32.0196 26.9052 32.0196 33 32.0196 33H16.0195V23" stroke="#165DFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14.9211 18.8883C14.1564 20.8688 15.6315 23 17.7546 23C19.4114 23 20.7638 21.6568 20.7638 20C20.7638 21.6568 22.1069 23 23.7638 23H24.273C25.9298 23 27.273 21.6568 27.273 20C27.273 21.6568 28.6259 23 30.2827 23C32.4069 23 33.8835 20.8676 33.1181 18.8861L31.8639 15.6396C31.715 15.2542 31.3443 15 30.9311 15H17.1084C16.6951 15 16.3244 15.2542 16.1755 15.6398L14.9211 18.8883Z" fill="#165DFF"/>
        </svg>
        <div class="desktop showroom-wrapper">
            <div class="name">${item.name}</div>
            <span style="width: auto;">${formRoomStatus(item.status)}</span>
            <div class="time">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M8.99949 2.87354C12.7794 2.87354 15.844 5.93747 15.8442 9.71729C15.8442 13.4973 12.7796 16.562 8.99949 16.562C5.21966 16.5618 2.15574 13.4972 2.15574 9.71729C2.15601 5.93762 5.21982 2.87378 8.99949 2.87354ZM8.91844 5.46143C8.54695 5.46176 8.24563 5.7627 8.24559 6.13428V9.84033C8.24573 10.0187 8.31675 10.1898 8.44285 10.3159L11.0591 12.9321C11.3219 13.1947 11.7474 13.1946 12.0102 12.9321C12.2731 12.6692 12.2731 12.2429 12.0102 11.98L9.59129 9.56104L9.59227 6.13428C9.59227 5.7625 9.29022 5.46147 8.91844 5.46143Z" fill="#165DFF"/>
                    <path d="M2.26784 3.99554L4.6241 2.3125L2.26784 3.99554Z" fill="#165DFF"/>
                    <path d="M2.26784 3.99554L4.6241 2.3125" stroke="#165DFF" stroke-width="1.34644" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.7322 3.99554L13.3759 2.3125L15.7322 3.99554Z" fill="#165DFF"/>
                    <path d="M15.7322 3.99554L13.3759 2.3125" stroke="#165DFF" stroke-width="1.34644" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span style="flex: 1;">${item.openDatetime}</span>
            </div>
            <div class="addr">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <mask id="path-1-outside-1_171_4317" maskUnits="userSpaceOnUse" x="0.04879" y="10.0024" width="18" height="8" fill="black">
                        <rect fill="white" x="0.04879" y="10.0024" width="18" height="8"/>
                        <path d="M4.08475 12.0024C2.82683 12.3798 2.04879 12.9012 2.04879 13.477C2.04879 14.6287 5.16096 15.5624 9.00001 15.5624C12.8391 15.5624 15.9512 14.6287 15.9512 13.477C15.9512 12.9012 15.1732 12.3798 13.9153 12.0024"/>
                    </mask>
                    <path d="M4.51578 13.4392C5.30927 13.2011 5.75954 12.3649 5.52149 11.5714C5.28344 10.7779 4.44721 10.3277 3.65373 10.5657L4.08475 12.0024L4.51578 13.4392ZM14.3463 10.5657C13.5528 10.3277 12.7166 10.7779 12.4785 11.5714C12.2405 12.3649 12.6907 13.2011 13.4842 13.4392L13.9153 12.0024L14.3463 10.5657ZM4.08475 12.0024L3.65373 10.5657C2.94677 10.7778 2.26539 11.0601 1.72726 11.4418C1.22811 11.7958 0.54879 12.4619 0.54879 13.477H2.04879H3.54879C3.54879 13.6888 3.47315 13.8375 3.42919 13.902C3.39263 13.9556 3.38372 13.9449 3.46284 13.8888C3.62822 13.7715 3.96482 13.6045 4.51578 13.4392L4.08475 12.0024ZM2.04879 13.477H0.54879C0.54879 14.4922 1.22809 15.1582 1.72725 15.5122C2.26539 15.8939 2.94677 16.1762 3.65373 16.3883C5.08675 16.8182 6.97656 17.0624 9.00001 17.0624V15.5624V14.0624C7.18441 14.0624 5.5986 13.8397 4.51578 13.5148C3.96481 13.3496 3.62822 13.1825 3.46285 13.0652C3.25851 12.9203 3.54879 13.0377 3.54879 13.477H2.04879ZM9.00001 15.5624V17.0624C11.0235 17.0624 12.9133 16.8182 14.3463 16.3883C15.0533 16.1762 15.7346 15.8939 16.2728 15.5122C16.7719 15.1582 17.4512 14.4922 17.4512 13.477H15.9512H14.4512C14.4512 13.0377 14.7415 12.9203 14.5372 13.0652C14.3718 13.1825 14.0352 13.3496 13.4842 13.5148C12.4014 13.8397 10.8156 14.0624 9.00001 14.0624V15.5624ZM15.9512 13.477H17.4512C17.4512 12.4618 16.7719 11.7958 16.2728 11.4418C15.7346 11.0601 15.0532 10.7778 14.3463 10.5657L13.9153 12.0024L13.4842 13.4392C14.0352 13.6045 14.3718 13.7715 14.5372 13.8888C14.6163 13.9449 14.6074 13.9556 14.5708 13.902C14.5269 13.8375 14.4512 13.6889 14.4512 13.477H15.9512Z" fill="#165DFF" mask="url(#path-1-outside-1_171_4317)"/>
                    <path d="M9.0001 1.39502C11.7793 1.39507 14.0323 3.59302 14.0323 6.3042C14.0322 10.1013 9.01308 13.3865 9.0001 13.395C9.0001 13.395 3.96803 10.1063 3.96787 6.3042C3.96787 3.59299 6.22086 1.39502 9.0001 1.39502ZM9.0001 4.09326C7.65662 4.09348 6.5665 5.18333 6.5665 6.52686C6.56694 7.87001 7.65689 8.95926 9.0001 8.95947C10.3433 8.95922 11.4323 7.86998 11.4327 6.52686C11.4327 5.18335 10.3435 4.09352 9.0001 4.09326Z" fill="#165DFF"/>
                </svg>
                <span style="flex: 1;">${item.address}</span>
            </div>
            <div class="stars-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M7.45229 7.28237L9.99938 2.08337V15.1747L4.85596 17.9167L5.85783 12.2188L1.66663 8.12133L7.45229 7.28237Z" fill="#FFD700"/>
                </svg>
                <span class="font-bold" style="padding-left: 8px;font-size: 16px;">4.9</span><span style="color: #9CA3AF;font-size: 14px;">/5.0</span>
            </div>
        </div>

        <div class="mobile showroom-wrapper">
          <div class="showroom-header">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="48" height="48" rx="8" fill="#165DFF" fill-opacity="0.1"/>
                <path d="M32.0196 23C32.0196 26.9052 32.0196 33 32.0196 33H16.0195V23" stroke="#165DFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14.9211 18.8883C14.1564 20.8688 15.6315 23 17.7546 23C19.4114 23 20.7638 21.6568 20.7638 20C20.7638 21.6568 22.1069 23 23.7638 23H24.273C25.9298 23 27.273 21.6568 27.273 20C27.273 21.6568 28.6259 23 30.2827 23C32.4069 23 33.8835 20.8676 33.1181 18.8861L31.8639 15.6396C31.715 15.2542 31.3443 15 30.9311 15H17.1084C16.6951 15 16.3244 15.2542 16.1755 15.6398L14.9211 18.8883Z" fill="#165DFF"/>
            </svg>
            <div class="name-status">
              <div class="name">${item.name}</div>
              ${formRoomStatus(item.status)}
            </div>
          </div>
            
            <div class="time">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M8.99949 2.87354C12.7794 2.87354 15.844 5.93747 15.8442 9.71729C15.8442 13.4973 12.7796 16.562 8.99949 16.562C5.21966 16.5618 2.15574 13.4972 2.15574 9.71729C2.15601 5.93762 5.21982 2.87378 8.99949 2.87354ZM8.91844 5.46143C8.54695 5.46176 8.24563 5.7627 8.24559 6.13428V9.84033C8.24573 10.0187 8.31675 10.1898 8.44285 10.3159L11.0591 12.9321C11.3219 13.1947 11.7474 13.1946 12.0102 12.9321C12.2731 12.6692 12.2731 12.2429 12.0102 11.98L9.59129 9.56104L9.59227 6.13428C9.59227 5.7625 9.29022 5.46147 8.91844 5.46143Z" fill="#165DFF"/>
                    <path d="M2.26784 3.99554L4.6241 2.3125L2.26784 3.99554Z" fill="#165DFF"/>
                    <path d="M2.26784 3.99554L4.6241 2.3125" stroke="#165DFF" stroke-width="1.34644" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.7322 3.99554L13.3759 2.3125L15.7322 3.99554Z" fill="#165DFF"/>
                    <path d="M15.7322 3.99554L13.3759 2.3125" stroke="#165DFF" stroke-width="1.34644" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span style="flex: 1;">${item.openDatetime}</span>
            </div>
            <div class="addr">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <mask id="path-1-outside-1_171_4317" maskUnits="userSpaceOnUse" x="0.04879" y="10.0024" width="18" height="8" fill="black">
                        <rect fill="white" x="0.04879" y="10.0024" width="18" height="8"/>
                        <path d="M4.08475 12.0024C2.82683 12.3798 2.04879 12.9012 2.04879 13.477C2.04879 14.6287 5.16096 15.5624 9.00001 15.5624C12.8391 15.5624 15.9512 14.6287 15.9512 13.477C15.9512 12.9012 15.1732 12.3798 13.9153 12.0024"/>
                    </mask>
                    <path d="M4.51578 13.4392C5.30927 13.2011 5.75954 12.3649 5.52149 11.5714C5.28344 10.7779 4.44721 10.3277 3.65373 10.5657L4.08475 12.0024L4.51578 13.4392ZM14.3463 10.5657C13.5528 10.3277 12.7166 10.7779 12.4785 11.5714C12.2405 12.3649 12.6907 13.2011 13.4842 13.4392L13.9153 12.0024L14.3463 10.5657ZM4.08475 12.0024L3.65373 10.5657C2.94677 10.7778 2.26539 11.0601 1.72726 11.4418C1.22811 11.7958 0.54879 12.4619 0.54879 13.477H2.04879H3.54879C3.54879 13.6888 3.47315 13.8375 3.42919 13.902C3.39263 13.9556 3.38372 13.9449 3.46284 13.8888C3.62822 13.7715 3.96482 13.6045 4.51578 13.4392L4.08475 12.0024ZM2.04879 13.477H0.54879C0.54879 14.4922 1.22809 15.1582 1.72725 15.5122C2.26539 15.8939 2.94677 16.1762 3.65373 16.3883C5.08675 16.8182 6.97656 17.0624 9.00001 17.0624V15.5624V14.0624C7.18441 14.0624 5.5986 13.8397 4.51578 13.5148C3.96481 13.3496 3.62822 13.1825 3.46285 13.0652C3.25851 12.9203 3.54879 13.0377 3.54879 13.477H2.04879ZM9.00001 15.5624V17.0624C11.0235 17.0624 12.9133 16.8182 14.3463 16.3883C15.0533 16.1762 15.7346 15.8939 16.2728 15.5122C16.7719 15.1582 17.4512 14.4922 17.4512 13.477H15.9512H14.4512C14.4512 13.0377 14.7415 12.9203 14.5372 13.0652C14.3718 13.1825 14.0352 13.3496 13.4842 13.5148C12.4014 13.8397 10.8156 14.0624 9.00001 14.0624V15.5624ZM15.9512 13.477H17.4512C17.4512 12.4618 16.7719 11.7958 16.2728 11.4418C15.7346 11.0601 15.0532 10.7778 14.3463 10.5657L13.9153 12.0024L13.4842 13.4392C14.0352 13.6045 14.3718 13.7715 14.5372 13.8888C14.6163 13.9449 14.6074 13.9556 14.5708 13.902C14.5269 13.8375 14.4512 13.6889 14.4512 13.477H15.9512Z" fill="#165DFF" mask="url(#path-1-outside-1_171_4317)"/>
                    <path d="M9.0001 1.39502C11.7793 1.39507 14.0323 3.59302 14.0323 6.3042C14.0322 10.1013 9.01308 13.3865 9.0001 13.395C9.0001 13.395 3.96803 10.1063 3.96787 6.3042C3.96787 3.59299 6.22086 1.39502 9.0001 1.39502ZM9.0001 4.09326C7.65662 4.09348 6.5665 5.18333 6.5665 6.52686C6.56694 7.87001 7.65689 8.95926 9.0001 8.95947C10.3433 8.95922 11.4323 7.86998 11.4327 6.52686C11.4327 5.18335 10.3435 4.09352 9.0001 4.09326Z" fill="#165DFF"/>
                </svg>
                <span style="flex: 1;">${item.address}</span>
            </div>
            <div class="stars-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99944 2.08337L7.45235 7.28237L1.66669 8.12133L5.8579 12.2188L4.85602 17.9167L9.99944 15.1747L15.1439 17.9167L14.1494 12.2188L18.3334 8.12133L12.5797 7.28237L9.99944 2.08337Z" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M9.99938 2.08337L7.45229 7.28237L1.66663 8.12133L5.85783 12.2188L4.85596 17.9167L9.99938 15.1747L15.1439 17.9167L14.1494 12.2188L18.3333 8.12133L12.5797 7.28237L9.99938 2.08337Z" stroke="#FFD700" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M7.45229 7.28237L9.99938 2.08337V15.1747L4.85596 17.9167L5.85783 12.2188L1.66663 8.12133L7.45229 7.28237Z" fill="#FFD700"/>
                </svg>
                <span class="font-bold stars-rating">4.9</span><span class="total-rating">/5.0</span>
            </div>
        </div>
      `;

      el.addEventListener("click", () => {
        document.querySelectorAll(".showroom-item")
          .forEach(i => i.classList.remove("active"));
        el.classList.add("active");
        switchShowroom(parseFloat(item.lat), parseFloat(item.lng));
      });

      container.appendChild(el);
    });
  }

  function formRoomStatus(status) {
    if(status === 0) return `<div class="status resting">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M4.08331 4.08337L9.91665 9.91671" stroke="#5D5D5D" stroke-width="1.16667" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.08331 9.91671L9.91665 4.08337" stroke="#5D5D5D" stroke-width="1.16667" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Resting
     </div>`;
    else if(status === 1 && isWithinBusinessHours()) return `<div class="status open">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M12.5416 3.2085L4.92185 10.7918L1.45831 7.34485" stroke="#36D399" stroke-width="1.16667" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Opening
    </div>`;
    else if(status === 1) return `<div class="status resting">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M4.08331 4.08337L9.91665 9.91671" stroke="#5D5D5D" stroke-width="1.16667" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.08331 9.91671L9.91665 4.08337" stroke="#5D5D5D" stroke-width="1.16667" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Resting
     </div>`;
     else return `<div class="status construction">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M6.49518 1.74829C6.71983 1.36025 7.28021 1.36034 7.50494 1.74829L13.4151 11.9573C13.6402 12.3462 13.3596 12.8333 12.9102 12.8333H1.08893C0.639751 12.8331 0.359025 12.3461 0.584045 11.9573L6.49518 1.74829ZM7.00006 9.62524C6.67791 9.62524 6.41707 9.8861 6.41705 10.2083V10.5002C6.41723 10.8223 6.678 11.0833 7.00006 11.0833C7.32208 11.0832 7.58289 10.8222 7.58307 10.5002V10.2083C7.58305 9.88613 7.32218 9.62529 7.00006 9.62524ZM7.00006 4.95923C6.6779 4.95923 6.41705 5.22007 6.41705 5.54224V8.45923C6.41756 8.78095 6.67823 9.04221 7.00006 9.04224C7.32187 9.04219 7.58256 8.78093 7.58307 8.45923V5.54224C7.58306 5.2201 7.32218 4.95927 7.00006 4.95923Z" fill="#FFC107"/>
        </svg>
        Under Construction
    </div>`;
  }

  function isWithinBusinessHours() {
      const now = new Date(); // 获取当前时间
      const dayOfWeek = now.getDay(); // 获取当前星期几 (0: Sun, 1: Mon, ..., 6: Sat)
      const hours = now.getHours(); // 当前小时
      const minutes = now.getMinutes(); // 当前分钟

      // 判断是否是工作日（周一至周五）
      if (dayOfWeek < 1 || dayOfWeek > 5) {
          return false; // 如果是周末，返回 false
      }

      // 判断当前时间是否在指定时间段内
      // 上午 09:00 - 12:00
      const morningStart = 9 * 60; // 09:00 转换为分钟
      const morningEnd = 12 * 60; // 12:00 转换为分钟

      // 下午 12:30 - 17:00
      const afternoonStart = 12 * 60 + 30; // 12:30 转换为分钟
      const afternoonEnd = 17 * 60; // 17:00 转换为分钟

      // 当前时间的分钟数
      const currentTimeInMinutes = hours * 60 + minutes;

      // 判断当前时间是否在工作时间内
      if ((currentTimeInMinutes >= morningStart && currentTimeInMinutes <= morningEnd) || 
          (currentTimeInMinutes >= afternoonStart && currentTimeInMinutes <= afternoonEnd)) {
          return true; // 在工作时间内
      }

      return false; // 不在工作时间内
  }


  /** 初始化地图 */
  function initMap(firstItem) {
    const lat = parseFloat(firstItem.lat);
    const lng = parseFloat(firstItem.lng);

    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat, lng },
      zoom: 12,
    });

    marker = new google.maps.Marker({
      position: { lat, lng },
      map,
    });
  }

  /** 切换 showroom */
  function switchShowroom(lat, lng) {
    const pos = { lat, lng };
    map.setCenter(pos);
    marker.setPosition(pos);
  }

  /** 页面加载时执行 */
  window.onload = loadShowrooms;
    
  const banner = document.querySelector('.section-image-with-text-overlay');
  banner.addEventListener('click', () => {
    if(JSON.parse(window.localStorage.getItem("smile_shopify_data")).customer === null) {
      const modalLogin = document.querySelector("modal-login");
      if (modalLogin) {
        console.log("modalLogin", modalLogin);
        const loginForm = modalLogin.showModal(
          modalLogin.fetchForm.login.innerHTML
        );
        modalLogin.loginBindEvent(loginForm.el);
      }
    } else {
      document.getElementById("showroom-map").scrollIntoView({
          behavior: "smooth",
          block: "start"
      });
    }
  })
</script>

{% schema %}
{
  "name": "Showroom Map",
  "tag": "section",
  "settings": [
    {
        "type": "text",
        "id": "section_heading",
        "label": "Section heading"
    },
    {
        "type": "text",
        "id": "description",
        "label": "Description"
    }
  ],
  "presets": [
    {
      "name": "Showroom Map"
    }
  ]
}
{% endschema %}
