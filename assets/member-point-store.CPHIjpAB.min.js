import{L as M,M as x}from"./theme.CHt78ou0.min.js";import{i as _}from"./member-api.DuLO-PVi.min.js";import{e as v,c as k,f as $,d as P}from"./utils.DPbg__7F.min.js";const S=window.Shopify.designMode||!1;class Z extends window.HTMLElement{constructor(){super(),this.loading=new M,this.initializeComponent(),this.bindEvents()}async initializeComponent(){const{config:t,api:s}=await _();this.sort=this.getSortConfig(),this.MemberApi=s,this.config=t,await this.update()}bindEvents(){this.addEventListener("click",t=>{const e=t.target.dataset.itemId;e&&this.handleProductClick(Number(e))})}getSortConfig(){var s;const t=(s=document.querySelector("#Points-sort-JSON"))==null?void 0:s.textContent;try{return t?JSON.parse(t):[]}catch(e){return console.error("Failed to parse JSON:",e),[]}}handleProductClick(t){this.modal=new x({className:{content:"max-w-2xl",body:"p-0 px-4 space-y-4"}});const{id:s,can_afford:e,need_more_points_text:i,points_product:a}=this.getProductById(t),{reward:{customized_image_url:n,image_url:d,description:m}}=a;this.modal.showModal({header:`
        <h2 class="text-xl font-bold m-0">Details</h2>
        <button id="close-header" class="w-8 h-8 flex items-center justify-center text-lg rounded-full bg-gray-600 text-white hover:bg-gray-900 hover:text-gray-50">&times;</button>
      `,content:`<div class="flex flex-col sm:flex-row items-center pt-4">
                  <!-- Gift Card Image -->
                  <div class="flex-shrink-0 aspect-square w-48 h-48">
                    <img class="lazyload object-cover w-full h-full" src="${n||d}" alt="${a.reward.name}">
                  </div>
                  
                  <!-- Gift Card Details -->
                  <div class="flex-1 mt-4 sm:mt-0 sm:ml-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-1">${a.reward.name}</h2>
                    <div class="flex items-center text-accent">
                      <svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="w-3.5 h-3.5">
                        <g stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
                          <g transform="translate(-848, -390)">
                            <g transform="translate(696, 259)">
                              <g transform="translate(151.9999, 95)">
                                <g transform="translate(0, 5)">
                                  <g transform="translate(0, 31)">
                                    <path d="M9.565,3.80458333 C9.565,4.575 7.69,5.43416667 5,5.43416667 C2.309,5.43416667 0.435,4.575 0.435,3.80458333 L0.435,2.805 C1.2145,3.50041667 2.9645,3.985 5,3.985 C7.0345,3.985 8.785,3.50041667 9.565,2.805 L9.565,3.80458333 Z M9.565,5.61583333 C9.565,6.38625 7.69,7.24583333 5,7.24583333 C2.309,7.24583333 0.435,6.38625 0.435,5.61583333 L0.435,4.61666667 C1.2145,5.31125 2.9645,5.79625 5,5.79625 C7.0345,5.79625 8.785,5.31125 9.565,4.61625 L9.565,5.61583333 Z M9.565,7.06416667 L9.565,7.4275 C9.565,8.19791667 7.69,9.0575 5,9.0575 C2.309,9.0575 0.435,8.19791667 0.435,7.4275 L0.435,6.42666667 C1.2145,7.12291667 2.9645,7.60833333 5,7.60833333 C7.0345,7.60833333 8.785,7.12333333 9.565,6.42666667 L9.565,7.06416667 Z M5,0.362083333 C7.69,0.362083333 9.565,1.22125 9.565,1.99291667 C9.565,2.76333333 7.69,3.62291667 5,3.62291667 C2.309,3.62291667 0.435,2.76375 0.435,1.99291667 C0.435,1.22125 2.3085,0.362083333 5,0.362083333 L5,0.362083333 Z M5,0 C2.239,0 0,0.892083333 0,1.99333333 L0,7.42791667 C0,8.52958333 2.239,9.42041667 5,9.42041667 C7.7615,9.42041667 10,8.52875 10,7.42791667 L10,1.99291667 C10,0.892083333 7.7615,0 5,0 L5,0 Z"></path>
                                  </g>
                                </g>
                              </g>
                            </g>
                          </g>
                        </g>
                      </svg>
                      <span class="text-base ml-2">${a.default_sort_order}</span>
                    </div>
                    
                    ${m?`<div class="mt-6">
                            <h3 class="text-base font-semibold text-gray-700 mb-1">Description</h3>
                            <p class="text-gray-500 text-sm">${m}</p>
                          </div>`:""}
                    
                  </div>
                </div>
                ${e?"":`<div class="bg-red-50 text-red-600 text-center py-2">${i}.</div>`}
            `,footer:`<div class="flex justify-end items-center gap-4">
                <button class="inline-flex items-center text-xs md:text-sm md:font-bold bg-accent hover:bg-accent-hover disabled:cursor-not-allowed disabled:bg-gray-400 text-white rounded-full py-2 px-8 hover:shadow-sm" ${e?"":"disabled"} data-redeem-id="${s}">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>  
                  Redeem Now
                </button>
               </div>`}),this.modal.el.addEventListener("click",async C=>{var g,h,u;const c=C.target.dataset.redeemId,l=new x({className:{body:"space-y-4"}});if(c){const f=this.modal.el.querySelector(`[data-redeem-id="${c}"]`).querySelector("svg");try{f.classList.remove("hidden");const{points_purchase:r}=await this.MemberApi.purchase(Number(c),{});if(r.fulfilled_reward.id){this.modal.closeModal(),l.showModal({header:`<h2 class="text-xl font-bold m-0">Redeem Successfully</h2>
                       <button id="close-header" class="w-8 h-8 flex items-center justify-center text-lg rounded-full bg-gray-600 text-white hover:bg-gray-900 hover:text-gray-50">&times;</button>`,content:`<div class="flex flex-col items-center pt-4">
                          <div class="flex-shrink-0 aspect-square w-48 h-48">
                            <img src="${r.fulfilled_reward.image_url}" alt="${r.fulfilled_reward.name}" class="lazyload w-full h-full object-cover">
                          </div>
                          <div>
                            <h3 class="text-lg font-semibold text-center m-0">${r.fulfilled_reward.name}</h3>
                            <div class="flex items-center justify-center text-accent">
                              <svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="w-3.5 h-3.5">
                                <g stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
                                  <g transform="translate(-848, -390)">
                                    <g transform="translate(696, 259)">
                                      <g transform="translate(151.9999, 95)">
                                        <g transform="translate(0, 5)">
                                          <g transform="translate(0, 31)">
                                            <path d="M9.565,3.80458333 C9.565,4.575 7.69,5.43416667 5,5.43416667 C2.309,5.43416667 0.435,4.575 0.435,3.80458333 L0.435,2.805 C1.2145,3.50041667 2.9645,3.985 5,3.985 C7.0345,3.985 8.785,3.50041667 9.565,2.805 L9.565,3.80458333 Z M9.565,5.61583333 C9.565,6.38625 7.69,7.24583333 5,7.24583333 C2.309,7.24583333 0.435,6.38625 0.435,5.61583333 L0.435,4.61666667 C1.2145,5.31125 2.9645,5.79625 5,5.79625 C7.0345,5.79625 8.785,5.31125 9.565,4.61625 L9.565,5.61583333 Z M9.565,7.06416667 L9.565,7.4275 C9.565,8.19791667 7.69,9.0575 5,9.0575 C2.309,9.0575 0.435,8.19791667 0.435,7.4275 L0.435,6.42666667 C1.2145,7.12291667 2.9645,7.60833333 5,7.60833333 C7.0345,7.60833333 8.785,7.12333333 9.565,6.42666667 L9.565,7.06416667 Z M5,0.362083333 C7.69,0.362083333 9.565,1.22125 9.565,1.99291667 C9.565,2.76333333 7.69,3.62291667 5,3.62291667 C2.309,3.62291667 0.435,2.76375 0.435,1.99291667 C0.435,1.22125 2.3085,0.362083333 5,0.362083333 L5,0.362083333 Z M5,0 C2.239,0 0,0.892083333 0,1.99333333 L0,7.42791667 C0,8.52958333 2.239,9.42041667 5,9.42041667 C7.7615,9.42041667 10,8.52875 10,7.42791667 L10,1.99291667 C10,0.892083333 7.7615,0 5,0 L5,0 Z"></path>
                                          </g>
                                        </g>
                                      </g>
                                    </g>
                                  </g>
                                </g>
                              </svg>
                              <span class="text-base ml-2">${r.fulfilled_reward.reason_text}</span>
                            </div>
                            <p class="text-gray-500 mt-6">${r.fulfilled_reward.usage_instructions}</p>
                          </div>

                          <div class="space-y-4 w-full max-w-sm">
                            <div class="flex items-center bg-gray-100 border border-gray-200 rounded-md p-2">
                              <span class="flex-1 text-lg font-medium text-gray-400" data-code>${v(r.fulfilled_reward.code)}</span>
                              <button class="ml-2 flex items-center text-gray-400 hover:text-gray-600" data-clip>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                                </svg>
                              </button>
                            </div>
                              ${r.fulfilled_reward.reward_token!=="shopify_gift_card"?`<button class="flex items-center justify-center w-full text-xs md:text-sm md:font-bold bg-accent hover:bg-accent-hover disabled:cursor-not-allowed disabled:bg-gray-400 text-white rounded-full py-2 px-8 hover:shadow-sm" data-apply>
                                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 hidden">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                      </svg>
                                      <span>Apply code</span>
                                    </button>`:""}
                          </div>
                        </div>`,onClose:async()=>await this.update()});const p=(g=l.el)==null?void 0:g.querySelector("[data-code]"),b=(h=l.el)==null?void 0:h.querySelector("[data-clip]"),o=(u=l.el)==null?void 0:u.querySelector("[data-apply]"),w=o==null?void 0:o.querySelector("svg"),y=o==null?void 0:o.querySelector("span");b.addEventListener("click",L=>{k(r.fulfilled_reward.code),p.innerHTML="Copy successfully!",setTimeout(()=>{p.innerHTML=v(r.fulfilled_reward.code)},1e3)}),o==null||o.addEventListener("click",async()=>{await $(`/discount/${r.fulfilled_reward.code}`)&&(w.setAttribute("disabled",!0),w.classList.remove("hidden"),y.classList.add("hidden"))})}}catch(r){console.error("Failed to load points products:",r)}finally{f.classList.add("hidden")}}})}getProductById(t){return this.pointsProducts.find(s=>t===s.id)}async update(){this.loading.show({message:"Please wait...",spinnerColor:"text-accent"});try{const{customer_points_products:t}=await this.MemberApi.getAllPointsProducts(),{customer:s}=await this.MemberApi.getCustomesInfo();this.customer=s,this.pointsProducts=P(t,this.sort);const e=new Map(this.sort.map(({id:i},a)=>[i,a]));this.pointsProducts.sort((i,a)=>{const n=e.has(i.id)?e.get(i.id):Number.MAX_SAFE_INTEGER,d=e.has(a.id)?e.get(a.id):Number.MAX_SAFE_INTEGER;return n-d}),this.renderProductList(this.pointsProducts)}catch(t){console.error("Failed to load points products:",t)}finally{this.loading.hide()}}renderProductList(t){if(!t||t.length===0){this.innerHTML="<div>No products available for redemption.</div>";return}const s=t.filter(e=>e.points_product.id!==void 0).map(e=>`
        <div class="p-4 rounded-lg border border-solid border-gray-100 h-full hover:shadow-md transition-all">
          <div class="flex items-center text-accent">
            <svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="w-3.5 h-3.5">
              <g stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
                <g transform="translate(-848, -390)">
                  <g transform="translate(696, 259)">
                    <g transform="translate(151.9999, 95)">
                      <g transform="translate(0, 5)">
                        <g transform="translate(0, 31)">
                          <path d="M9.565,3.80458333 C9.565,4.575 7.69,5.43416667 5,5.43416667 C2.309,5.43416667 0.435,4.575 0.435,3.80458333 L0.435,2.805 C1.2145,3.50041667 2.9645,3.985 5,3.985 C7.0345,3.985 8.785,3.50041667 9.565,2.805 L9.565,3.80458333 Z M9.565,5.61583333 C9.565,6.38625 7.69,7.24583333 5,7.24583333 C2.309,7.24583333 0.435,6.38625 0.435,5.61583333 L0.435,4.61666667 C1.2145,5.31125 2.9645,5.79625 5,5.79625 C7.0345,5.79625 8.785,5.31125 9.565,4.61625 L9.565,5.61583333 Z M9.565,7.06416667 L9.565,7.4275 C9.565,8.19791667 7.69,9.0575 5,9.0575 C2.309,9.0575 0.435,8.19791667 0.435,7.4275 L0.435,6.42666667 C1.2145,7.12291667 2.9645,7.60833333 5,7.60833333 C7.0345,7.60833333 8.785,7.12333333 9.565,6.42666667 L9.565,7.06416667 Z M5,0.362083333 C7.69,0.362083333 9.565,1.22125 9.565,1.99291667 C9.565,2.76333333 7.69,3.62291667 5,3.62291667 C2.309,3.62291667 0.435,2.76375 0.435,1.99291667 C0.435,1.22125 2.3085,0.362083333 5,0.362083333 L5,0.362083333 Z M5,0 C2.239,0 0,0.892083333 0,1.99333333 L0,7.42791667 C0,8.52958333 2.239,9.42041667 5,9.42041667 C7.7615,9.42041667 10,8.52875 10,7.42791667 L10,1.99291667 C10,0.892083333 7.7615,0 5,0 L5,0 Z"></path>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
            </svg>
            <span class="text-base ml-2">${e.points_product.exchange_description}</span>
          </div>
          ${S?`<div class="flex flex-col text-sm mt-2"><span class="text-red-500 text-xs">编辑的时候显示</span><div>ID: ${e.points_product.id}</div></div>`:""}
          <div class="aspect-square bg-gray-100 overflow-hidden flex justify-center items-center">
            <img
              class="lazyload object-cover object-center w-full h-full"
              width="360"
              height="360"
              data-src="${e.points_product.reward.image_url}"
            >
          </div>

          <h4 class="font-normal text-sm md:text-base m-0 min-h-12 line-clamp-2">${e.points_product.reward.name}</h4>

          <button class="flex items-center justify-center text-xs md:text-sm md:font-bold bg-accent hover:bg-accent-hover disabled:cursor-not-allowed disabled:bg-gray-400 text-white rounded-full py-2 px-8 w-full mt-6 hover:shadow-sm" data-item-id="${e.id}">
            <span class="pointer-events-none">Learn More</span>
          </button>
        </div>`).join("");this.innerHTML=s}}window.customElements.define("member-point-store",Z);
