import{L as d,M as h,S as u}from"./theme.CHt78ou0.min.js";import{i as y}from"./member-api.DuLO-PVi.min.js";class m extends window.HTMLElement{constructor(){super(),this.loading=new d,this.birthdayModal=new h,this.initComponent(),this.bindEvents()}async initComponent(){const{config:t,api:a}=await y();this.MemberApi=a,this.config=t,this.update()}async update(){this.loading.show({message:"Please wait...",spinnerColor:"text-accent"});try{const{customer_activity_rules:t}=await this.MemberApi.getCustomerActivityRulesAsync(),{customer:a}=await this.MemberApi.getCustomesInfo();this.customer=a,this.activityRules=t,this.renderActivityRules(t)}catch(t){console.error("Error fetching activity rules:",t)}finally{this.loading.hide()}}bindEvents(){this.addEventListener("click",t=>{const{dataset:a}=t.target,{type:e}=a;if(!e)return;const r=this.activityRules.find(i=>i.activity_rule.type===e);switch(e){case"customer_birthday":this.showBirthdayModal();break;default:this.action(r);break}})}renderActivityRules(t){if(!t||t.length===0){this.innerHTML="<div>No activity rules available.</div>";return}const a=t.map(e=>e.activity_rule.is_enabled?`
          <div class="p-4 h-full bg-[#F8F9FC] space-y-12 rounded-lg border border-solid border-gray-100 opacity-100 hover:shadow-md transition-all">
            <div class="flex items-center justify-between">
              <div class="flex flex-col">
                <h4 class="font-extrabold text-xl m-0">${e.activity_rule.name}</h4>
                <div class="flex items-center text-accent">
                  <svg
                    viewBox="0 0 10 10"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    class="w-3.5 h-3.5"
                  >
                    <g stroke="none" stroke-width="1" fill="currentColor" fill-rule="evenodd">
                        <g transform="translate(-848, -390)">
                            <g transform="translate(696, 259)">
                                <g transform="translate(151.9999, 95)">
                                    <g transform="translate(0, 5)">
                                        <g transform="translate(0, 31)">
                                            <path d="M9.565,3.80458333 C9.565,4.575 7.69,5.43416667 5,5.43416667 C2.309,5.43416667 0.435,4.575 0.435,3.80458333 L0.435,2.805 C1.2145,3.50041667 2.9645,3.985 5,3.985 C7.0345,3.985 8.785,3.50041667 9.565,2.805 L9.565,3.80458333 Z M9.565,5.61583333 C9.565,6.38625 7.69,7.24583333 5,7.24583333 C2.309,7.24583333 0.435,6.38625 0.435,5.61583333 L0.435,4.61666667 C1.2145,5.31125 2.9645,5.79625 5,5.79625 C7.0345,5.79625 8.785,5.31125 9.565,4.61625 L9.565,5.61583333 Z M9.565,7.06416667 L9.565,7.4275 C9.565,8.19791667 7.69,9.0575 5,9.0575 C2.309,9.0575 0.435,8.19791667 0.435,7.4275 L0.435,6.42666667 C1.2145,7.12291667 2.9645,7.60833333 5,7.60833333 C7.0345,7.60833333 8.785,7.12333333 9.565,6.42666667 L9.565,7.06416667 Z M5,0.362083333 C7.69,0.362083333 9.565,1.22125 9.565,1.99291667 C9.565,2.76333333 7.69,3.62291667 5,3.62291667 C2.309,3.62291667 0.435,2.76375 0.435,1.99291667 C0.435,1.22125 2.3085,0.362083333 5,0.362083333 L5,0.362083333 Z M5,0 C2.239,0 0,0.892083333 0,1.99333333 L0,7.42791667 C0,8.52958333 2.239,9.42041667 5,9.42041667 C7.7615,9.42041667 10,8.52875 10,7.42791667 L10,1.99291667 C10,0.892083333 7.7615,0 5,0 L5,0 Z"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </g>
                  </svg>
                  <span class="text-base ml-2">${e.activity_rule.value_description}</span>
                </div>
              </div>

              <img class="lazyload w-10 h-10" data-src="${e.activity_rule.image_svg}" />
            </div>
            ${e.will_become_available?e.activity_rule.action_text?`<button class="inline-flex items-center bg-accent hover:bg-accent-hover text-white font-semibold rounded-full py-2 px-8" data-type="${e.activity_rule.type}">
                      <span class="ml-2 pointer-events-none">${e.activity_rule.type==="customer_birthday"?"Edit Date":`${e.activity_rule.action_text} Now`}</span>
                    </button>`:"":`<div class="inline-flex items-center bg-white rounded-full p-2 pr-3">
                    <div class="bg-accent rounded-full w-6 h-6 flex items-center justify-center text-white">
                      <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11.917 9.724 16.5 19 7.5"/>
                      </svg>
                    </div>
                    <span class="ml-2">Got the Points</span>
                  </div>`}
          </div>`:"").join("");this.innerHTML=a}showBirthdayModal(){var e,r,i,l,s,o;this.birthdayModal.showModal({header:`
        <h2 class="text-xl font-bold m-0">Birthday reward</h2>
        <button id="close-header" class="w-8 h-8 flex items-center justify-center text-lg rounded-full bg-gray-600 text-white hover:bg-gray-900 hover:text-gray-50">&times;</button>
      `,content:`
        <p class="text-sm text-gray-500">We want to celebrate your birthday! Make sure you let us know at least one month in advance â€” otherwise, you'll have to wait until next year.</p>
        <form id="birthdayForm">
          <div class="flex items-center gap-4">
            <div class="w-32">
              <label for="day" class="block text-gray-700">Day</label>
              <input
                type="number"
                id="day"
                name="day"
                class="border border-gray-300 !p-2 w-full !h-auto"
                min="1"
                max="31"
                value="${((r=(e=this.customer)==null?void 0:e.date_of_birth)==null?void 0:r.split("-")[2])||""}"
                required
              >
            </div>
            <div class="w-32">
              <label for="month" class="block text-gray-700">Month</label>
              <input
                type="number"
                id="month"
                name="month"
                class="border border-gray-300 !p-2 w-full !h-auto"
                min="1"
                max="12"
                value="${((l=(i=this.customer)==null?void 0:i.date_of_birth)==null?void 0:l.split("-")[1])||""}"
                required
              >
            </div>
            <div class="w-full">
              <label for="year" class="block text-gray-700">Year</label>
              <input
                type="number"
                id="year"
                name="year"
                class="border border-gray-300 !p-2 w-full !h-auto"
                min="1900"
                max="${new Date().getFullYear()}"
                value="${((o=(s=this.customer)==null?void 0:s.date_of_birth)==null?void 0:o.split("-")[0])||""}"
                required
              >
            </div>
          </div>
          <p class="text-red-500 text-sm m-0 min-h-5" data-error-message></p>
        </form>
        `,footer:`<div class="flex justify-end items-center gap-4">
                <button id="close-footer" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" type="cancel">Cancel</button>
                <button class="bg-accent hover:bg-accent-hover text-white py-2 px-4 rounded" type="submit">Confirm</button>
               </div>`});const t=this.birthdayModal.modal.querySelector('[type="submit"]');this.birthdayModal.modal.querySelectorAll('[type="number"]').forEach(n=>{n.addEventListener("change",()=>{this.birthdayModal.modal.querySelector("[data-error-message]").innerHTML="",this.birthdayModal.modal.querySelectorAll("#day","#month","#year").forEach(c=>c.style.borderColor="")})}),t.addEventListener("click",n=>this.submitBirthdayForm(n))}validateBirthdayInput(t,{day:a,month:e,year:r}){const i=t.querySelector("[data-error-message]");return["#day","#month","#year"].forEach(l=>{t.querySelector(l).style.borderColor=""}),!a||a<1||a>31?(t.querySelector("#day").style.borderColor="#f00",i.innerHTML="Please check the date format.",!1):!e||e<1||e>12?(t.querySelector("#month").style.borderColor="#f00",i.innerHTML="Please check the month format.",!1):!r||r<1900||r>new Date().getFullYear()?(t.querySelector("#year").style.borderColor="#f00",i.innerHTML="Please check the year format.",!1):!0}async submitBirthdayForm(t){t.preventDefault();const{modal:a}=this.birthdayModal,e=a.querySelector("#day").value,r=a.querySelector("#month").value,i=a.querySelector("#year").value;if(this.validateBirthdayInput(a,{day:e,month:r,year:i})){this.loading.show({message:"Please wait...",spinnerColor:"text-accent"});const s={customer:{date_of_birth:new Date(`${i}-${r}-${e}`).toISOString()}};try{const{customer:o}=await this.MemberApi.putCustomersAsync(s);o.id&&(this.birthdayModal.closeModal(),this.initComponent())}catch(o){console.error("Failed to update customer information:",o)}finally{this.birthdayModal.closeModal(),this.loading.hide()}}}async action(t){const{activity_rule:a}=t,{type:e,like_url:r,share_url:i,username:l}=a;if(!e)return;const s=new u;switch(this.loading.show({message:"Please wait...",spinnerColor:"text-accent"}),e){case"facebook_like":s.share("facebookLike",{url:r});break;case"facebook_share":s.share("facebook",{url:i});break;case"instagram_follow":s.share("instagramFollow",{url:l});break;case"tiktok_follow":s.share("tiktokFollow",{url:l});break;case"twitter_follow":s.share("twitterFollow",{url:l});break}try{const{customer:oxx}=await this.MemberApi.putCustomersAsync(s);const{activity:o}=await this.MemberApi.postActivities({activity:{token:e,customer_id:oxx.id}});o.id&&(this.loading.hide(),this.update())}catch(o){console.error("Failed to update customer information:",o)}finally{this.loading.hide()}}shareUrl(t,a){}}window.customElements.define("member-earn-point",m);
