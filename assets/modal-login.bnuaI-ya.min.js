import{M as m}from"./theme.MUy1K6ka.min.js";const u=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
</svg>`,g=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
</svg>`,w=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
</svg>
`;class v extends window.HTMLElement{constructor(){super(),this.returToUrl=this.dataset.return||window.location.href||"/",this.form=null}connectedCallback(){this.init()}async init(){const{login:e,create:t,recover:r}=await this.fetchLoginEl();this.fetchForm={login:e,create:t,recover:r},this.loginEl.forEach(s=>s.addEventListener("click",o=>this.showLoginForm(o))),this.joinEl.forEach(s=>s.addEventListener("click",o=>this.showJoinForm(o)))}showRecoverForm(e){var t,r;e.preventDefault(),(t=this.loginForm)==null||t.closeModal(),(r=this.creatForm)==null||r.closeModal(),this.recoverForm=this.showModal(this.fetchForm.recover.innerHTML),this.recoverBindEvent(this.recoverForm.el)}showJoinForm(e){var t,r;e.preventDefault(),(t=this.loginForm)==null||t.closeModal(),(r=this.recoverForm)==null||r.closeModal(),this.creatForm=this.showModal(this.fetchForm.create.innerHTML),this.creatBindEvent(this.creatForm.el)}showLoginForm(e){var t,r;e.preventDefault(),(t=this.creatForm)==null||t.closeModal(),(r=this.recoverForm)==null||r.closeModal(),this.loginForm=this.showModal(this.fetchForm.login.innerHTML),this.loginBindEvent(this.loginForm.el)}async fetchLoginEl(){try{const t=await(await window.fetch("/?sections=member-login,member-register,member-recover",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}})).text(),r=JSON.parse(t);return{login:this.getSectionInnerHTML(r["member-login"]),create:this.getSectionInnerHTML(r["member-register"]),recover:this.getSectionInnerHTML(r["member-recover"])}}catch(e){console.error("获取登录元素失败:",e)}}showModal(e){return e?new m({className:{content:"max-w-6xl bg-white rounded-2xl overflow-hidden",body:"p-0"}}).showModal({content:e}):void 0}loginBindEvent(e){const t=e.querySelector('[href="/account/register"]'),r=e.querySelector('[href="/account/login#recover"]'),s=e.querySelector("#customer_login"),o=e.querySelector('[type="email"]'),n=e.querySelector('[type="password"]'),i=e.querySelector('[type="submit"]'),a=e.querySelector("#email-error"),c=e.querySelector("#password-error"),l=e.querySelector("#err-message");this.bindTogglePassword(e),o.addEventListener("input",()=>this.validateForm(o,a,i,l)),n.addEventListener("input",()=>this.validateForm(n,c,i,l)),s.addEventListener("submit",async d=>{if(d.preventDefault(),this.validateForm(o,a,i,l),this.validateForm(n,c,i,l),i.disabled)return;const h=await this.handleFormSubmission(s,i,l,"login");h&&h&&(window.location.href=this.returToUrl)}),t.addEventListener("click",d=>this.showJoinForm(d)),r.addEventListener("click",d=>this.showRecoverForm(d))}creatBindEvent(e){const t=e.querySelector("#create_customer"),r=e.querySelector('[type="email"]'),s=e.querySelector('[type="password"]'),o=e.querySelector('[type="submit"]'),n=e.querySelector("#email-error"),i=e.querySelector("#password-error"),a=e.querySelector("#err-message"),c=e.querySelector('[href="/account/login"]');this.bindTogglePassword(e),r.addEventListener("input",()=>this.validateForm(r,n,o,a)),s.addEventListener("input",()=>this.validateForm(s,i,o,a)),c.addEventListener("click",l=>this.showLoginForm(l)),t.addEventListener("submit",async l=>{if(l.preventDefault(),this.validateForm(r,n,o,a),this.validateForm(s,i,o,a),o.disabled)return;await this.handleFormSubmission(t,o,a,"create")&&(window.location.href=this.returToUrl)})}recoverBindEvent(e){const t=e.querySelector("#recover-form"),r=e.querySelector('[type="email"]'),s=e.querySelector("#email-error"),o=e.querySelector('[type="submit"]'),n=e.querySelector("#err-message"),i=e.querySelector("#success-message"),a=e.querySelector('[href="/account/login"]');r.addEventListener("input",()=>this.validateForm(r,s,o,n)),a.addEventListener("click",c=>this.showLoginForm(c)),t.addEventListener("submit",async c=>{if(c.preventDefault(),this.validateForm(r,s,o,n),o.disabled)return;await this.handleFormSubmission(t,o,n,"recover")&&(i.classList.remove("hidden"),setTimeout(()=>{i.classList.add("hidden")},5e3))})}validateForm(e,t,r,s){const o=e.type==="email"?this.isValidEmail(e.value):this.isValidPassword(e.value);this.updateInputStyles(e,o),t.classList.toggle("invisible",o),this.toggleButtonState(r,o),s.classList.add("hidden")}bindTogglePassword(e){const t=e.querySelector("#toggle-password"),r=e.querySelector('[type="password"]');t.addEventListener("click",()=>{this.togglePasswordVisibility(r,t)})}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPassword(e){return/^.{6,}$/.test(e)}updateInputStyles(e,t){e.style.borderColor=t?"":"#ef4444"}toggleButtonState(e,t){e.disabled=!t,e.classList.toggle("opacity-50",e.disabled),e.classList.toggle("cursor-not-allowed",e.disabled)}togglePasswordVisibility(e,t){const r=e.getAttribute("type")==="password"?"text":"password";e.setAttribute("type",r),t.innerHTML=r==="password"?u:g}async handleFormSubmission(e,t,r,s="login"){t.disabled=!0;const o=t.innerHTML;t.innerHTML="Submitting...";let n="",i="";s==="recover"?(n="/account/recover",i="#recover .form-notification.error"):s==="create"?(n="/account?view=json",i=".form-notification.error"):(n="/account/login?view=json",i="#login .form-notification.error");try{const a=new FormData(e),c=await window.fetch(n,{method:"POST",body:a}).then(d=>d.text()),l=this.getSectionInnerHTML(c,i);return console.log(l),l?(this.showErrorMessage(r,l.textContent),!1):!0}catch(a){console.error("请求失败:",a),this.showErrorMessage(r,"There was a problem with the server, please try again later.")}finally{t.disabled=!1,t.innerHTML=o}}showErrorMessage(e,t){e.innerHTML=`${w}<span class="ml-3">${t}</span>`,e.classList.remove("hidden")}getSectionInnerHTML(e,t=".shopify-section"){return new window.DOMParser().parseFromString(e,"text/html").querySelector(t)}get loginEl(){return this.querySelectorAll("[data-login]")}get joinEl(){return this.querySelectorAll("[data-join]")}}window.customElements.define("modal-login",v);
