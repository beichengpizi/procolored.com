var m=i=>{throw TypeError(i)};var _=(i,t,e)=>t.has(i)||m("Cannot "+e);var s=(i,t,e)=>(_(i,t,"read from private field"),e?e.call(i):t.get(i)),u=(i,t,e)=>t.has(i)?m("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),l=(i,t,e,n)=>(_(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);import"./theme.b18B71bI.min.js";const g="https://platform.smile.io",w="pub_942aa29435118d88";class y{constructor(t){this.baseURL=t}setHeaders(t){this.headers=t}async fetchUrl(t,e,n=null,c={}){let h={...this.headers||{}};c.excludeHeaders&&Array.isArray(c.excludeHeaders)&&c.excludeHeaders.forEach(a=>{delete h[a]});const d={method:t,headers:{...h,...c.headers},body:n?JSON.stringify(n):null};d.signal=c.signal;const p=this.baseURL+e;try{const a=await fetch(p,d);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(a){throw console.error("Fetch error:",a),a}}get(t,e={}){return this.fetchUrl("GET",t,null,e)}post(t,e,n={}){return this.fetchUrl("POST",t,e,n)}put(t,e,n={}){return this.fetchUrl("PUT",t,e,n)}delete(t,e={}){return this.fetchUrl("DELETE",t,null,e)}}var r,o;class f{constructor(t=g,e=w){u(this,r);u(this,o);l(this,r,new y(t)),this.channelKey=e,s(this,r).setHeaders(this.getDefaultHeaders())}getDefaultHeaders(t=""){return{"Content-Type":"application/json","x-smile-publishable-key":this.channelKey,"smile-channel-key":"channel_li6VC28S28AqDkmJ3E1ug0gV","Smile-Client":"smile-ui",...t&&{Authorization:`Bearer ${t}`}}}async init(){let t={};try{const e=await s(this,r).get(`/smile_ui/init?publishableKey=${this.channelKey}`);try{t=JSON.parse(window.localStorage.getItem("smile_shopify_data"))||{}}catch(c){console.error("Failed to parse localStorage data",c)}const n=await s(this,r).post("/v1/shopify/identify_customer",t);return l(this,o,n.customer),this.config=e,s(this,r).setHeaders(this.getDefaultHeaders(n.auth_token)),{customer:s(this,o),config:this.config,api:{putCustomersAsync:this.putCustomersAsync.bind(this),postActivities:this.postActivities.bind(this),getCustomesInfo:this.getCustomesInfo.bind(this),getBestPointsProductToShow:this.getBestPointsProductToShow.bind(this),getCustomerPointsProducts:this.getCustomerPointsProducts.bind(this),getCustomerActivityRulesAsync:this.getCustomerActivityRulesAsync.bind(this),getAllPointsProducts:this.getAllPointsProducts.bind(this),fetchAllPointsPointsTransactions:this.fetchAllPointsPointsTransactions.bind(this),getRewardFulfillments:this.getRewardFulfillments.bind(this),purchase:this.purchase.bind(this)}}}catch(e){throw console.error("Failed to initialize Smile API",e),e}}async putCustomersAsync(t){return s(this,r).put(`/customers/${s(this,o).id}`,t)}async postActivities(t){return await s(this,r).post("/smile_ui/activities",t,{excludeHeaders:["x-smile-publishable-key"]})}async getCustomesInfo(){return s(this,r).get("/v1/smile_ui_customers/me?include=next_vip_tier.image_svg,vip_tier.image_svg,")}async getBestPointsProductToShow(){return s(this,r).get(`/v1/customers/${s(this,o).id}/best_points_product_to_show?include=reward,current_available_points_product.reward.image_svg,next_points_product.reward.image_svg`)}async getCustomerPointsProducts(){return s(this,r).get(`/v1/customer_points_products/${s(this,o).id}?include=reward,customer_points_products.points_product.reward.image_svg`)}async getCustomerActivityRulesAsync(t=10,e=""){return s(this,r).get(`/v1/customer_activity_rules?customer_id=${s(this,o).id}&include=activity_rule,image_svg,metadata&limit=${t}&cursor=${e}`)}async getAllPointsProducts(t=10,e=""){return s(this,r).get(`/v1/customer_points_products?customer_id=${s(this,o).id}&include=reward,customer_points_products.points_product.reward.image_svg,metadata&limit=${t}&cursor=${e}`)}async fetchAllPointsPointsTransactions(t=10,e=""){return s(this,r).get(`/v1/points_transactions?include=image_svg,source_description,instructions_html,reward,state,metadata&limit=${t}&cursor=${e}`)}async getRewardFulfillments(){return s(this,r).get("/v1/reward_fulfillments?include=image_svg,source_description,instructions_html,reward,state&is_transient=false")}async purchase(t,e){const n={...e,customer_id:s(this,o).id};return s(this,r).post(`/v1/points_products/${t}/purchase?include=reward_fulfillment.image_svg,reward_fulfillment.reward,reward_fulfillment.source_description,reward_fulfillment.instructions_html&customer_id=${s(this,o).id}`,n)}async waitForObject(t){for(;typeof window[t]!="object";)await new Promise(e=>setTimeout(e,100));return window[t]}}r=new WeakMap,o=new WeakMap;async function A(){return await new f().init()}export{A as i};
