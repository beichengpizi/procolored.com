<style>
  /* 直播小窗口 Live broadcast window start  */
  .live-broadcast-window-wrapper {
    position: fixed;
    left: 30px;
    bottom: 110px;
    z-index: 9999;
  }
  .live-broadcast-window-url {
    display: block;
    position: relative;
    width: 180px;

    border-radius: 10px;
    overflow: hidden;
    flex-shrink: 0;
  }
  .live-broadcast-window-close-icon {
    display: none;
    position: absolute;
    top: 9px;
    right: 10px;
    width: 18px;
    height: 18px;
    z-index: 99;
  }
  .live-broadcast-window-img {
    display: none;
    width: 100%;

    max-width: 100%;
    aspect-ratio: 4/5;
  }
  .live-broadcast-window-video {
    display: none;
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 比例 */
    height: 0;
    overflow: hidden;
    aspect-ratio: 16/9;
  }
  .live-broadcast-window-video iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
  @media screen and (max-width: 1440px) {
    .live-broadcast-window-url {
      width: 90px;
      border-radius: 6px;
    }
    .live-broadcast-window-close-icon {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 12px;
      height: 12px;
      z-index: 99;
    }
  }
  @media screen and (max-width: 768px) {
    .live-broadcast-window-wrapper {
      left: 16px;
      bottom: 104px;
    }
  }
  /* 直播小窗口 Live broadcast window end  */
</style>
<!-- 直播小窗口 Live broadcast window start -->
<section id="live-broadcast-window-section">
  <div class="live-broadcast-window-wrapper" data-live-countdown-start="2025-11-01T08:00:00+08:00">
    <a
      class="live-broadcast-window-url"
      href="https://www.youtube.com/live/h-VrUoJpg6c"
      target="_blank"
    >
      <div class="live-broadcast-window-close-icon" id="live-broadcast-window-close-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 18" fill="none">
          <g clip-path="url(#clip0_7343_17516)">
            <path d="M3.34596 14.0383L14.0379 3.34642M3.34596 3.34642L14.0379 14.0383" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          </g>
          <defs>
            <clipPath id="clip0_7343_17516">
              <rect width="18" height="18" rx="9" fill="white"/>
            </clipPath>
          </defs>
        </svg>
      </div>
      <img
        class="live-broadcast-window-img lazyload"
        data-src="https://cdn.shopify.com/s/files/1/0509/3454/6613/files/20251021-152945.jpg?v=1761031820"
        alt=""
      >

      <div class="live-broadcast-window-video">
        <iframe
          src="https://www.youtube.com/embed/h-VrUoJpg6c?&amp;autoplay=1&amp;mute=1&amp;controls=0"
          title="K13 Lite DTF Printer & Smoke-Free Oven | Introduction & Demo"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen
        ></iframe>
      </div>
    </a>
  </div>
</section>
<script>
   // 用于存储倒计时实例
  let liveBroadcastCountdownInstance = null;

   document.addEventListener('DOMContentLoaded', function () {
     // 直播小窗口
     if ($('.live-broadcast-window-wrapper')) {
       $('.live-broadcast-window-wrapper').each(function () {
         const $wrapper = $(this);
         const UTCDate_start = $wrapper.data('live-countdown-start'); // 直播开始时间
         console.log('UTCDate_start==', UTCDate_start);
         const finalDate_start = formatUtcTime(UTCDate_start);
         const finalDate2 = finalDate_start ? finalDate_start : null;
         const timestamp_end = finalDate2 ? new Date(finalDate2).getTime() : null;
         const currentTimestamp = new Date().getTime();
         let format;
         $('.live-broadcast-window-close-icon').show();
         console.log('直播开始本地时间==', finalDate_start);

         // 如果直播开始时间已到，则直接显示视频，隐藏图片
         // 到时间后重载视频，防止播放异常
         if (timestamp_end && currentTimestamp > timestamp_end) {

           // 重新设置iframe的src以强制重载
           const $video = $('.live-broadcast-window-video');
           const $iframe = $video.find('iframe');
           const src = $iframe.attr('src');
           $iframe.attr('src', src);
           $video.show();
         }else {
          $('.live-broadcast-window-img').show();

         }

         // 保存倒计时实例
         liveBroadcastCountdownInstance = $wrapper.countdown(finalDate2)
           .on('update.countdown', function (event) {
             {% comment %} format = ' Ends in %D Days %H:%M:%S';

             $(this).html(event.strftime(format)); {% endcomment %}
           })
           .on('finish.countdown', function (event) {
             // 增加：隐藏关闭按钮，显示视频
             $('.live-broadcast-window-img').hide();
               // 重新设置iframe的src以强制重载
              const $video = $('.live-broadcast-window-video');
              const $iframe = $video.find('iframe');
              const src = $iframe.attr('src');
              $iframe.attr('src', src);
              $video.show();
           });
       });
     }

     // 关闭按钮事件
     $('#live-broadcast-window-close-btn').on('click', function (e) {
       e.preventDefault();
       // 隐藏直播小窗口
       $('.live-broadcast-window-wrapper').hide();
       // 停止倒计时
       if (liveBroadcastCountdownInstance && typeof liveBroadcastCountdownInstance.countdown === 'function') {
         liveBroadcastCountdownInstance.countdown('stop');
       }
     });
   });
</script>
<!-- 直播小窗口 Live broadcast window end -->
